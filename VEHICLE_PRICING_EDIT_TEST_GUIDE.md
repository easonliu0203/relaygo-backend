# 車型價格設定修改功能測試指南

**日期**: 2025-12-03  
**目的**: 驗證公司端可以正常修改車型等級和其他欄位  
**修復內容**: 移除 UNIQUE 約束以允許修改 vehicle_type

---

## 測試環境

### 公司端 Web Admin
- **URL**: https://admin.relaygo.pro
- **測試頁面**: 設定 > 價格設定
- **測試帳號**: 需要 Admin 權限的帳號

### Supabase Dashboard
- **URL**: https://supabase.com/dashboard/project/vlyhwegpvpnjyocqmfqc
- **測試表**: vehicle_pricing (Table Editor)

---

## 測試案例

### 測試 1: 修改車型等級 (vehicle_type)

**測試步驟**:
1. 登入公司端: https://admin.relaygo.pro
2. 進入「設定 > 價格設定」頁面
3. 找到任一方案（例如: M - Medium 中型 6小時）
4. 點擊「編輯」按鈕
5. 修改「車型等級」下拉選單（例如: M → S）
6. 點擊「確定」或「儲存」按鈕

**預期結果**:
- ✅ 修改成功，顯示「更新成功」訊息
- ✅ 表格中該方案的車型等級已更新為 S
- ✅ 無 409 Conflict 錯誤
- ✅ 無 duplicate key 錯誤

**測試資料**:
```
修改前: M - Medium 中型 6小時
修改後: S - Small 小型 6小時
```

---

### 測試 2: 修改車型描述 (vehicle_description)

**測試步驟**:
1. 編輯任一方案
2. 修改「車型描述」欄位（例如: "RAV4 等車型" → "CAMRY 等車型"）
3. 儲存修改

**預期結果**:
- ✅ 修改成功
- ✅ 表格中顯示更新後的車型描述

---

### 測試 3: 修改內容描述 (capacity_info)

**測試步驟**:
1. 編輯任一方案
2. 修改「內容描述」欄位（例如: "最多4人,2個行李" → "最多3人,2個行李"）
3. 儲存修改

**預期結果**:
- ✅ 修改成功
- ✅ 表格中顯示更新後的內容描述
- ✅ 客戶端 APP 選擇方案頁面顯示更新後的內容

---

### 測試 4: 修改時長 (duration_hours)

**測試步驟**:
1. 編輯任一方案
2. 修改「時長設定」下拉選單（例如: 6小時 → 8小時）
3. 儲存修改

**預期結果**:
- ✅ 修改成功
- ✅ 表格中顯示更新後的時長

**注意**: 
- 時長只能選擇 6 或 8 小時（受 CHECK 約束限制）
- 如選擇其他值會出現錯誤

---

### 測試 5: 修改價格 (base_price)

**測試步驟**:
1. 編輯任一方案
2. 修改「價格設定」欄位（例如: 3000 → 3500）
3. 儲存修改

**預期結果**:
- ✅ 修改成功
- ✅ 表格中顯示更新後的價格（NT$3,500）
- ✅ 客戶端 APP 顯示更新後的價格

---

### 測試 6: 修改超時費 (overtime_rate)

**測試步驟**:
1. 編輯任一方案
2. 修改「超時費/小時」欄位（例如: 350 → 400）
3. 儲存修改

**預期結果**:
- ✅ 修改成功
- ✅ 表格中顯示更新後的超時費（NT$400/小時）

---

### 測試 7: 切換啟用狀態 (is_active)

**測試步驟**:
1. 找到任一方案
2. 點擊「啟用/停用」開關
3. 觀察狀態變化

**預期結果**:
- ✅ 狀態切換成功
- ✅ 顯示「已啟用該方案」或「已停用該方案」訊息
- ✅ 停用的方案不會出現在客戶端 APP

---

### 測試 8: Supabase Table Editor 直接修改

**測試步驟**:
1. 登入 Supabase Dashboard
2. 進入 Table Editor > vehicle_pricing
3. 點擊任一記錄的 `vehicle_type` 欄位
4. 修改為其他值（例如: M → S）
5. 按 Enter 或點擊其他欄位儲存

**預期結果**:
- ✅ 修改成功
- ✅ 無 duplicate key 錯誤
- ✅ 記錄已更新

---

### 測試 9: 新增方案

**測試步驟**:
1. 點擊「新增方案」按鈕
2. 填寫所有必填欄位:
   - 車型等級: S
   - 車型描述: CAMRY 等車型
   - 內容描述: 最多3人,2個行李
   - 時長設定: 4小時
   - 價格設定: 2500
   - 超時費/小時: 300
   - 顯示順序: 11
3. 點擊「確定」

**預期結果**:
- ✅ 新增成功
- ✅ 表格中出現新方案
- ✅ 客戶端 APP 顯示新方案（如果啟用）

**注意**: 
- 時長可以選擇 4、6 或 8 小時
- 但目前 CHECK 約束只允許 6 或 8，選擇 4 會失敗

---

### 測試 10: 刪除方案

**測試步驟**:
1. 找到測試用的方案
2. 點擊「刪除」按鈕
3. 確認刪除

**預期結果**:
- ✅ 刪除成功
- ✅ 表格中該方案已移除
- ✅ 客戶端 APP 不再顯示該方案

---

## 錯誤測試

### 錯誤測試 1: 修改為無效的車型等級

**測試步驟**:
1. 使用 Supabase Table Editor
2. 嘗試將 `vehicle_type` 修改為 'Z'（無效值）

**預期結果**:
- ❌ 修改失敗
- ❌ 顯示 CHECK 約束錯誤
- ✅ 只允許 XS, S, M, L, XL

---

### 錯誤測試 2: 修改為負數價格

**測試步驟**:
1. 編輯任一方案
2. 嘗試將價格設定為 -100

**預期結果**:
- ❌ 修改失敗（前端驗證）
- ❌ 或顯示 CHECK 約束錯誤（後端驗證）
- ✅ 價格必須 >= 0

---

## 客戶端 APP 驗證

### 驗證步驟

1. **修改公司端價格設定**:
   - 修改 S 小型 6小時方案的內容描述為「最多3人,2個行李 (已更新)」
   - 修改價格為 3200

2. **重新啟動客戶端 APP**:
   ```bash
   cd D:\repo\mobile
   flutter run --flavor customer
   ```

3. **檢查選擇方案頁面**:
   - 進入「選擇方案」頁面
   - 找到 S 小型 6小時方案
   - 驗證顯示內容:
     - 第一行: "CAMRY 等車型 6小時 NT$3,200"
     - 第二行: "最多3人,2個行李 (已更新)"
     - 第三行: "超時費: NT$350/小時"

**預期結果**:
- ✅ 客戶端 APP 顯示更新後的內容
- ✅ 價格格式正確（千分位分隔符）
- ✅ 三行顯示格式正確

---

## 測試檢查清單

- [ ] 測試 1: 修改車型等級 ✅
- [ ] 測試 2: 修改車型描述 ✅
- [ ] 測試 3: 修改內容描述 ✅
- [ ] 測試 4: 修改時長 ✅
- [ ] 測試 5: 修改價格 ✅
- [ ] 測試 6: 修改超時費 ✅
- [ ] 測試 7: 切換啟用狀態 ✅
- [ ] 測試 8: Supabase Table Editor 直接修改 ✅
- [ ] 測試 9: 新增方案 ✅
- [ ] 測試 10: 刪除方案 ✅
- [ ] 錯誤測試 1: 無效車型等級 ✅
- [ ] 錯誤測試 2: 負數價格 ✅
- [ ] 客戶端 APP 驗證 ✅

---

## 測試報告範本

```
測試日期: ___________
測試人員: ___________

測試結果:
- 修改車型等級: [ ] 通過 [ ] 失敗
- 修改車型描述: [ ] 通過 [ ] 失敗
- 修改內容描述: [ ] 通過 [ ] 失敗
- 修改時長: [ ] 通過 [ ] 失敗
- 修改價格: [ ] 通過 [ ] 失敗
- 修改超時費: [ ] 通過 [ ] 失敗
- 切換啟用狀態: [ ] 通過 [ ] 失敗
- Supabase 直接修改: [ ] 通過 [ ] 失敗
- 新增方案: [ ] 通過 [ ] 失敗
- 刪除方案: [ ] 通過 [ ] 失敗
- 客戶端 APP 驗證: [ ] 通過 [ ] 失敗

問題記錄:
___________________________________________
___________________________________________
___________________________________________

總結:
[ ] 所有測試通過，功能正常
[ ] 部分測試失敗，需要修復
```

---

**測試指南版本**: 1.0  
**最後更新**: 2025-12-03

